# Структура файла плана закупок

Парсер плана закупок ожидает Excel файл (`.xlsx` или `.xls`) со следующей структурой:

## Общие требования

- **Формат файла**: Excel (`.xlsx` или `.xls`)
- **Лист с данными**: Парсер ищет лист с названием **"Данные"** (без учета регистра). Если лист "Данные" не найден, используется первый лист файла.
- **Заголовки**: Парсер автоматически ищет строку с заголовками в первых 10 строках файла. Строка считается заголовком, если в ней найдено хотя бы 2 из 4 основных колонок (Год, Компания, ЦФО, Предмет закупки).

## Обязательные колонки

Для успешной загрузки данных необходимо наличие следующих колонок (хотя бы 2 из 4 основных):

### Основные колонки

1. **Год** (обязательная)
   - **Альтернативные названия**: "Год плана"
   - **Тип данных**: Целое число (Integer)
   - **Формат**: Число или строка с числом (например: `2024`, `"2024"`)
   - **Пример**: `2024`, `2025`

2. **Компания** (обязательная)
   - **Альтернативные названия**: "Компания/Организация"
   - **Тип данных**: Текст (String)
   - **Формат**: Любой текст
   - **Пример**: `ООО "Компания"`, `АО "Предприятие"`

3. **ЦФО** (обязательная)
   - **Альтернативные названия**: "Центр финансовой ответственности"
   - **Тип данных**: Текст (String)
   - **Формат**: Любой текст
   - **Пример**: `ЦФО-1`, `Центр финансовой ответственности`

4. **Предмет закупки** (обязательная)
   - **Альтернативные названия**: "Предмет", "Наименование предмета закупки"
   - **Тип данных**: Текст (String)
   - **Формат**: Любой текст
   - **Пример**: `Закупка оборудования`, `Услуги по обслуживанию`
   - **Важно**: Строки без значения в этой колонке будут пропущены

## Опциональные колонки

5. **Бюджет закупки/сумма договора** (опциональная)
   - **Основное название**: "Бюждетзакупки/суммадоговора(UZS)"
   - **Альтернативные названия**: 
     - "Бюджет закупки/сумма договора(UZS)"
     - "Бюждетзакупки/суммадоговора(UZS)"
     - "Бюджет закупки/сумма договора"
     - "Бюджет закупки"
     - "Бюджет"
     - "Сумма договора"
   - **Тип данных**: Число с плавающей точкой (BigDecimal)
   - **Формат**: 
     - Число в Excel (например: `1000000`)
     - Строка с числом, может содержать пробелы, запятые, неразрывные пробелы, суффикс "UZS" (например: `"1 000 000 UZS"`, `"1,000,000"`, `"1000000 UZS"`)
   - **Пример**: `1000000`, `"1 000 000 UZS"`, `"500,000"`

6. **Срок окончания действия договора** (опциональная)
   - **Основное название**: "Срок окончания действия договора"
   - **Альтернативные названия**: 
     - "Срок окончания договора"
     - "Дата окончания договора"
   - **Тип данных**: Дата (LocalDate)
   - **Формат**: 
     - Дата в формате Excel (ячейка с типом даты)
     - Строка с датой в одном из форматов:
       - `dd.MM.yyyy` (например: `31.12.2024`)
       - `yyyy-MM-dd` (например: `2024-12-31`)
       - `dd/MM/yyyy` (например: `31/12/2024`)
       - `MM/dd/yyyy` (например: `12/31/2024`)
       - `dd-MM-yyyy` (например: `31-12-2024`)
       - `yyyy.MM.dd` (например: `2024.12.31`)
   - **Пример**: `31.12.2024`, `2024-12-31`

7. **Дата заявки** (опциональная)
   - **Основное название**: "Дата заявки"
   - **Альтернативные названия**: "Дата заявки на закупку"
   - **Тип данных**: Дата (LocalDate)
   - **Формат**: Аналогично "Срок окончания действия договора"
   - **Пример**: `01.01.2024`, `2024-01-01`

8. **Дата нового договора** (опциональная)
   - **Основное название**: "Дата нового договора"
   - **Альтернативные названия**: "Дата нового контракта"
   - **Тип данных**: Дата (LocalDate)
   - **Формат**: Аналогично "Срок окончания действия договора"
   - **Пример**: `15.06.2024`, `2024-06-15`

9. **Закупщик** (опциональная)
   - **Основное название**: "Закупщик"
   - **Альтернативные названия**: 
     - "Ответственный за ЗП (Закупочная процедура)"
     - "Ответственный за ЗП"
     - "Ответственный за закупку"
   - **Тип данных**: Текст (String)
   - **Формат**: Любой текст
   - **Пример**: `Иванов И.И.`, `Отдел закупок`

## Пример структуры файла

```
| Год | Компания | ЦФО | Предмет закупки | Бюджет закупки/сумма договора(UZS) | Срок окончания действия договора | Дата заявки | Дата нового договора | Закупщик |
|-----|----------|-----|-----------------|-------------------------------------|----------------------------------|-------------|----------------------|----------|
| 2024| ООО "А"  | ЦФО1| Оборудование    | 1000000                              | 31.12.2024                       | 01.01.2024  | 15.06.2024           | Иванов И.И. |
| 2024| ООО "Б"  | ЦФО2| Услуги          | 500000                               | 30.11.2024                       | 15.02.2024   | 20.07.2024           | Петров П.П. |
```

## Особенности парсинга

1. **Поиск заголовков**: Парсер автоматически находит строку с заголовками, проверяя первые 10 строк файла.

2. **Гибкий поиск колонок**: Парсер использует частичное совпадение названий колонок (без учета регистра), поэтому небольшие различия в названиях допустимы.

3. **Обработка пустых строк**: Пустые строки автоматически пропускаются.

4. **Обновление существующих записей**: Если запись с таким же "Предмет закупки" (без учета регистра) уже существует в базе, она будет обновлена новыми данными.

5. **Валидация**: Строки без значения в колонке "Предмет закупки" будут пропущены.

## Рекомендации

- Используйте лист с названием "Данные" для более надежной работы парсера
- Размещайте заголовки в первой строке файла
- Убедитесь, что колонка "Предмет закупки" заполнена для всех строк, которые нужно загрузить
- Для дат рекомендуется использовать формат `dd.MM.yyyy` или формат даты Excel
- Для бюджетов можно использовать числа или строки с форматированием (пробелы, запятые, "UZS" будут автоматически удалены)

